<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>地圖 | MoData</title>
    <link rel="stylesheet" href="/mo_data/css/styles.css" />
    <link rel="stylesheet" href="/mo_data/css/map.css" />
    <style>
      /* 縮略圖 */
      .thumbnail {
        width: 90%;
        height: auto; /* 自動維持比例 */
        cursor: pointer;
        transition: transform 0.3s ease;
        display: block;
        margin: 0 auto;
      }
      .thumbnail:hover {
        transform: scale(1.05);
      }

      /* 隱藏checkbox */
      #zoomToggle {
        display: none;
      }

      /* 放大視窗 */
      .lightbox {
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100vh;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        cursor: zoom-out;
        z-index: 9999;
        overflow: hidden;
      }

      /* checkbox選中時顯示 */
      #zoomToggle:checked + .lightbox {
        display: flex;
      }

      /* 放大圖 */
      .lightbox img {
        max-width: 90%;
        max-height: 90%;
        box-shadow: 0 0 30px rgba(255, 255, 255, 0.6);
        border-radius: 10px;
        transition: transform 0.2s ease;
        cursor: grab;
        user-select: none;
      }

      /* 拖曳時 cursor */
      .lightbox img.dragging {
        cursor: grabbing;
      }

      /* 置中h2 */
      #maparea h2 {
        text-align: center;
      }
    </style>
  </head>

  <body>
    <div id="nav-container"></div>
    <script src="/mo_data/js/componentsLoader.js"></script>

    <div id="content2">
      <h1></h1>

      <section id="maparea">
        <h2>一般地圖</h2>
        <label for="zoomToggle">
          <img
            class="thumbnail"
            src="/mo_data/pic/map/map.png"
            alt="遊戲地圖縮略圖"
          />
        </label>
        <input type="checkbox" id="zoomToggle" />

        <div
          class="lightbox"
          id="lightbox"
          onclick="if(event.target.id==='lightbox'){document.getElementById('zoomToggle').checked=false; resetTransform();}"
        >
          <img
            id="zoomedImage"
            src="/mo_data/pic/map/map.png"
            alt="遊戲地圖放大圖"
            draggable="false"
          />
        </div>
        <p class="map-tip" style="text-align:center;">
          點擊圖片可放大，放大後可用滑鼠滾輪縮放與拖曳，點擊背景關閉
        </p>
      </section>
    </div>

    <div id="content2">
      <h1></h1>

      <section id="maparea">
        <h2>仙界地圖</h2>
        <label for="zoomToggle">
          <img
            class="thumbnail"
            src="/mo_data/pic/map/map.png"
            alt="遊戲地圖縮略圖"
          />
        </label>
        <input type="checkbox" id="zoomToggle" />

        <div
          class="lightbox"
          id="lightbox"
          onclick="if(event.target.id==='lightbox'){document.getElementById('zoomToggle').checked=false; resetTransform();}"
        >
          <img
            id="zoomedImage"
            src="/mo_data/pic/map/map.png"
            alt="遊戲地圖放大圖"
            draggable="false"
          />
        </div>
        <p class="map-tip" style="text-align:center;">
          點擊圖片可放大，放大後可用滑鼠滾輪縮放與拖曳，點擊背景關閉
        </p>
      </section>
    </div>

    <div id="footer-container"></div>

    <script>
      const zoomedImage = document.getElementById('zoomedImage');
      let scale = 1;
      const minScale = 0.5;
      const maxScale = 5;

      let isDragging = false;
      let startX = 0;
      let startY = 0;
      let translateX = 0;
      let translateY = 0;

      function updateTransform() {
        zoomedImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
      }

      function resetTransform() {
        scale = 1;
        translateX = 0;
        translateY = 0;
        updateTransform();
      }

      // 滾輪縮放
      document.getElementById('lightbox').addEventListener('wheel', (e) => {
        e.preventDefault();
        const scaleAmount = e.deltaY < 0 ? 1.1 : 0.9;
        const prevScale = scale;
        scale *= scaleAmount;
        scale = Math.min(maxScale, Math.max(minScale, scale));

        // 計算滑鼠相對圖片的偏移量，讓縮放時中心對齊滑鼠位置
        const rect = zoomedImage.getBoundingClientRect();
        const offsetX = e.clientX - rect.left;
        const offsetY = e.clientY - rect.top;

        // 調整 translateX, translateY 讓圖片縮放時不會跳動
        translateX -= (offsetX - translateX) * (scale / prevScale - 1);
        translateY -= (offsetY - translateY) * (scale / prevScale - 1);

        updateTransform();
      });

      // 拖曳開始
      zoomedImage.addEventListener('mousedown', (e) => {
        e.preventDefault();
        isDragging = true;
        startX = e.clientX - translateX;
        startY = e.clientY - translateY;
        zoomedImage.classList.add('dragging');
      });

      // 拖曳中
      window.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        translateX = e.clientX - startX;
        translateY = e.clientY - startY;
        updateTransform();
      });

      // 拖曳結束
      window.addEventListener('mouseup', () => {
        if (isDragging) {
          isDragging = false;
          zoomedImage.classList.remove('dragging');
        }
      });

      // 進入放大時重置縮放及位置
      document.getElementById('zoomToggle').addEventListener('change', (e) => {
        if (e.target.checked) {
          resetTransform();
        }
      });
    </script>
  </body>
</html>
