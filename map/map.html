<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>地圖 | MoData</title>
    <link rel="stylesheet" href="/mo_data/css/styles.css" />
    <link rel="stylesheet" href="/mo_data/css/map.css" />
  </head>

  <body>
    <div id="nav-container"></div>
    <script src="/mo_data/js/componentsLoader.js"></script>

    <div id="content">
      <h1></h1>

      <section id="maparea">
        <h2>一般地圖（可縮放與拖曳）</h2>
        <div class="map-container" id="mapContainer">
          <img
            id="mapImage"
            src="/mo_data/pic/map/map.png"
            alt="遊戲地圖"
            class="map-image"
          />
        </div>
        <p class="map-tip">滑鼠滾輪縮放，拖曳可移動地圖</p>
      </section>
    </div>

    <div id="footer-container"></div>

    <script>
      const mapImg = document.getElementById("mapImage");
      const mapContainer = document.getElementById("mapContainer");

      // === 初始狀態 ===
      let scale = 1;
      let posX = 0;
      let posY = 0;
      let isDragging = false;
      let startX, startY;

      // === 滾輪縮放 ===
      mapContainer.addEventListener("wheel", (e) => {
        e.preventDefault();
        const zoomSpeed = 0.1;
        const delta = e.deltaY > 0 ? -zoomSpeed : zoomSpeed;

        scale = Math.min(Math.max(scale + delta, 0.5), 4); // 限制縮放範圍 0.5~4
        updateTransform();
      });

      // === 拖曳地圖 ===
      mapContainer.addEventListener("mousedown", (e) => {
        isDragging = true;
        startX = e.clientX - posX;
        startY = e.clientY - posY;
        mapContainer.style.cursor = "grabbing";
      });

      document.addEventListener("mouseup", () => {
        isDragging = false;
        mapContainer.style.cursor = "grab";
      });

      document.addEventListener("mousemove", (e) => {
        if (!isDragging) return;
        posX = e.clientX - startX;
        posY = e.clientY - startY;
        updateTransform();
      });

      // === 手機支援觸控拖曳 ===
      mapContainer.addEventListener("touchstart", (e) => {
        if (e.touches.length === 1) {
          isDragging = true;
          startX = e.touches[0].clientX - posX;
          startY = e.touches[0].clientY - posY;
        }
      });

      mapContainer.addEventListener("touchmove", (e) => {
        if (isDragging && e.touches.length === 1) {
          posX = e.touches[0].clientX - startX;
          posY = e.touches[0].clientY - startY;
          updateTransform();
        }
      });

      mapContainer.addEventListener("touchend", () => {
        isDragging = false;
      });

      // === 更新地圖變換 ===
      function updateTransform() {
        mapImg.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
      }
    </script>
    <div id="footer-container"></div><!-- 這是頁尾會被載入的位置 -->
  </body>
</html>